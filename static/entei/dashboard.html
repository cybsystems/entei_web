<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="apple-touch-icon" sizes="76x76" href="/img/apple-icon.png" />
    <link rel="icon" type="image/png" href="/img/favicon.png" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <title>
      Entei
    </title>
    <meta
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no"
      name="viewport"
    />
    <!--     Fonts and icons     -->
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700,200" rel="stylesheet" />
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" rel="stylesheet" />
    <!-- CSS Files -->
    <link href="css/bootstrap.min.css" rel="stylesheet" />
    <link href="css/paper-dashboard.css?v=2.0.0" rel="stylesheet" />
    <!-- CSS Just for demo purpose, don't include it in your project -->
  </head>

  <body onload="onLoad()">
    <!-- Modal -->
    <div class="modal fade" id="myModal" role="dialog">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title" id="video_title"></h4>
            <button type="button" class="close" data-dismiss="modal">&times;</button>
          </div>
          <div class="modal-body">
            <video width="100%" height="240" id="video_to_show" controls></video>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
    <!-- Modal -->

    <div class="wrapper ">
      <div class="sidebar" data-color="white" data-active-color="danger">
        <div class="logo">
          <a href="#" class="simple-text logo-mini">
            <div class="logo-image-small">
              <img src="/img/logo-small.png" />
            </div>
          </a>
          <a href="#" class="simple-text logo-normal">
            Entei
          </a>
        </div>
        <div class="sidebar-wrapper">
          <ul class="nav">
            <li class="active" onclick="sendIvitationClicked()">
              <a href="#">
                <i class="nc-icon nc-bank"></i>
                <p>Send Invitation</p>
              </a>
            </li>

            <li class="active" onclick="uploadMenuClicked()">
              <a href="#">
                <i class="nc-icon nc-bank"></i>
                <p>Upload Video</p>
              </a>
            </li>

            <li class="active" onclick="onStudentsClicked()">
              <a href="#">
                <i class="nc-icon nc-bank"></i>
                <p>Students</p>
              </a>
            </li>
          </ul>
        </div>
      </div>

      <div class="main-panel">
        <!-- Navbar -->
        <nav class="navbar navbar-expand-lg navbar-absolute fixed-top navbar-transparent">
          <div class="container-fluid">
            <div class="navbar-wrapper">
              <div class="navbar-toggle">
                <button type="button" class="navbar-toggler">
                  <span class="navbar-toggler-bar bar1"></span>
                  <span class="navbar-toggler-bar bar2"></span>
                  <span class="navbar-toggler-bar bar3"></span>
                </button>
              </div>
              <a class="navbar-brand" href="#pablo">Dashboard</a>
            </div>
            <button
              class="navbar-toggler"
              type="button"
              data-toggle="collapse"
              data-target="#navigation"
              aria-controls="navigation-index"
              aria-expanded="false"
              aria-label="Toggle navigation"
            >
              <span class="navbar-toggler-bar navbar-kebab"></span>
              <span class="navbar-toggler-bar navbar-kebab"></span>
              <span class="navbar-toggler-bar navbar-kebab"></span>
            </button>
            <div class="collapse navbar-collapse justify-content-end" id="navigation">
              <form>
                <div class="input-group no-border">
                  <input type="text" value="" class="form-control" placeholder="Search..." />
                  <div class="input-group-append">
                    <div class="input-group-text">
                      <i class="nc-icon nc-zoom-split"></i>
                    </div>
                  </div>
                </div>
              </form>
              <ul class="navbar-nav">
                <li class="nav-item">
                  <a class="nav-link btn-magnify" href="#pablo">
                    <i class="nc-icon nc-layout-11"></i>
                    <p>
                      <span class="d-lg-none d-md-block">Stats</span>
                    </p>
                  </a>
                </li>
                <li class="nav-item btn-rotate dropdown">
                  <a
                    class="nav-link dropdown-toggle"
                    href="http://example.com"
                    id="navbarDropdownMenuLink"
                    data-toggle="dropdown"
                    aria-haspopup="true"
                    aria-expanded="false"
                  >
                    <i class="nc-icon nc-bell-55"></i>
                    <p>
                      <span class="d-lg-none d-md-block">Some Actions</span>
                    </p>
                  </a>
                  <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownMenuLink">
                    <a class="dropdown-item" href="#">Action</a>
                    <a class="dropdown-item" href="#">Another action</a>
                    <a class="dropdown-item" href="#">Something else here</a>
                  </div>
                </li>
                <li class="nav-item">
                  <a class="nav-link btn-rotate" href="#pablo">
                    <i class="nc-icon nc-settings-gear-65"></i>
                    <p>
                      <span class="d-lg-none d-md-block">Account</span>
                    </p>
                  </a>
                </li>
              </ul>
            </div>
          </div>
        </nav>
        <!-- Navbar -->

        <div class="content">
          <!--INVITATION-->
          <div class="content" id="add_student">
            <div class="row">
              <div class="col-md-12">
                <div class="card ">
                  <div class="card-header ">
                    <h5 class="card-title">Send Invitation</h5>
                  </div>
                  <div class="card-body ">
                    <div class="row">
                      <div class="col-lg-10">
                        <div class="form-group">
                          <label for="email">Enter Email</label>
                          <input id="email" type="text" class="form-control" placeholer="Enter Email" />
                        </div>

                        <div class="form-group">
                          <div style="float:right;">
                            <button onclick="onSendInvitation()" class="btn btn-primary">Send Invitation</button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!--INVITATION-->

          <!--VIDEO-->

          <div class="content" id="upload_video" style="display:none;">
            <div class="row">
              <div class="col-md-12">
                <div class="card ">
                  <div class="card-header ">
                    <h5 class="card-title">UPLOAD VIDEO</h5>
                    <h5 id="loading" style="display:none;">Uploading Video.....</h5>
                  </div>

                  <div class="card-body ">
                    <div class="row">
                      <div class="col-lg-10">
                        <div class="form-group">
                          <label for="video_name">Video Name</label>
                          <input
                            type="text"
                            class="form-control"
                            id="video_name"
                            aria-describedby="emailHelp"
                            placeholder="Enter Video Name"
                          />
                        </div>
                        <div class="form-group">
                          <label for="category">Select Category</label>

                          <select id="category" class="form-control">
                            <option value="MARATHI_MED">
                              Marathi Medium
                            </option>
                            <option value="ENGLISH_MED">
                              English Medium
                            </option>
                            <option value="MPSC">
                              MPSC
                            </option>

                            <option value="UPSC">
                              UPSC
                            </option>
                          </select>
                        </div>

                        <div class="form-group">
                          <label for="class">Select Class</label>

                          <select id="class" class="form-control"> </select>
                        </div>

                        <div class="form-group">
                          <label for="desc">Description</label>
                          <textarea class="form-control" id="desc" rows="3" placeholder="Enter Description"></textarea>
                        </div>

                        <button class="btn btn-primary">
                          <input type="file" id="video_file" />
                        </button>

                        <div class="form-group">
                          <div class="pull-right ">
                            <button class="btn btn-primary" onclick="onSubmit()">Submit</button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!--VIDEO-->

          <div class="row" id="data_panel"></div>
        </div>
      </div>

      <footer class="footer footer-black  footer-white ">
        <div class="container-fluid">
          <div class="row">
            <nav class="footer-nav">
              <ul>
                <li>
                  <a href="https://www.creative-tim.com" target="_blank">Creative Tim</a>
                </li>
                <li>
                  <a href="http://blog.creative-tim.com/" target="_blank">Blog</a>
                </li>
                <li>
                  <a href="https://www.creative-tim.com/license" target="_blank">Licenses</a>
                </li>
              </ul>
            </nav>
            <div class="credits ml-auto">
              <span class="copyright">
                <script>
                  document.write(new Date().getFullYear());</script
                >, made with <i class="fa fa-heart heart"></i> by Creative Tim
              </span>
            </div>
          </div>
        </div>
      </footer>
    </div>
    <!--   Core JS Files   -->
    <script src="js/jquery.min.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/perfect-scrollbar.jquery.min.js"></script>
 
    <!--  Google Maps Plugin    -->
    <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_KEY_HERE"></script>
    <!-- Chart JS -->
    <script src="/js/chartjs.min.js"></script>
    <!--  Notifications Plugin    -->
    <script src="js/bootstrap-notify.js"></script>
    <!-- Control Center for Now Ui Dashboard: parallax effects, scripts for the example pages etc -->
    <script src="js/paper-dashboard.min.js?v=2.0.0" type="text/javascript"></script>
    <!-- Paper Dashboard DEMO methods, don't include it in your project! -->
 
 <script src='./utils.js'></script>
 <script>
     
      function getUrlVars() {
        var vars = {};
        var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m, key, value) {
          vars[key] = value;
        });
        return vars;
      }

      function _(id) {
        return document.getElementById(id);
      }

      function onLoad() {
        if (getUrlVars().logedin) {
          $.post("http://bhoomi.pe.hu/entei/query.php", { sql: "select * from invitations" }, function(res, err) {
            let invitations = JSON.parse(res).res;

            _("data_panel").innerHTML = "";
            invitations.forEach(function(invitation) {
              _("data_panel").innerHTML +=
                '<div class="col-lg-4"><div class="card" style="margin-left:10px;"><div class="card-body"> Email:  ' +
                invitation.email +
                "   </div>" +
                '<div class="card-footer"><button class="btn btn-danger" onclick="onIvitaionRemove(this)" id="' +
                invitation.id +
                '">REMOVE</button></div>' +
                "</div></div>";
            });
          });
        } else {
          window.location = "http://bhoomi.pe.hu/entei/";
        }
      }
    </script>

    <!--INVITATION-->
    <script>
      function onIvitaionRemove(btn) {
        let id = btn.id;

        let sql = "delete  from invitations where id=" + id;

        $.post("http://bhoomi.pe.hu/entei/query.php", { sql: sql, op: "REMOVE" }, function(res, err) {
          console.log(res);
          onLoad();
        });
      }

      async function onSendInvitation() {
        let email = _("email").value;
        let isInvitationPresent = await isPresent("invitations", "email", email);
        if (isInvitationPresent) {
          alert("Invitation Already Sent");
        return;
        }
        
        $.post("http://bhoomi.pe.hu/entei/sendInvitation.php", { email: email }, function(res, err) {
          console.log(res);
          onLoad();
        });
      }

     </script>
    <!--INVITATION-->

    <!--STUDENTS-->

    <script>
      function onStudentsClicked() {
        _("add_student").style.display = "none";
        _("upload_video").style.display = "none";

        let sql = "select * from users";
        $.post("http://bhoomi.pe.hu/entei/query.php", { sql: sql }, function(res, err) {
          let students = JSON.parse(res).res;
          _("data_panel").innerHTML = "";
          if (students.length == 0) {
            _("data_panel").innerHTML = "<center>NO STUDENTS</center>";
            return;
          }

          students.forEach(function(students) {
            _("data_panel").innerHTML +=
              '<div class="col-lg-4"><div class="card" style="margin-left:10px;"><div class="card-body"> Name:  ' +
              students.users_name +
              " <br> Username: " +
              students.users_uname +
              " </div>" +
              '<div class="card-footer"><button class="btn btn-danger" onclick="onStudentRemove(this)" id="' +
              students.users_id +
              '">REMOVE</button></div>' +
              "</div></div>";
          });
        });
      }

      function onStudentRemove(btn) {
        let id = btn.id;

        let sql = "delete  from users where users_id=" + id;

        $.post("http://bhoomi.pe.hu/entei/query.php", { sql: sql, op: "REMOVE" }, function(res, err) {
          onStudentsClicked();
        });
      }
    </script>
    <!--STUDENTS-->

    <!--VIDEOS-->

    <script>
      function onVideoClick(evt) {
        let arr = evt.id.split("show_");
        if (arr.length == 2) {
          var index = parseInt(arr[1]);
          var video = videos[index];
          $("#myModal").modal("show");
          console.log(video);
          var url = "http://bhoomi.pe.hu/entei/" + video.videos_url;
          console.log(url);
          $("#video_title").text(video.videos_title);
          $("#video_to_show").html('<source src="' + url + '" type="video/mp4"></source>');
        }
      }
      let videos = [];
      function uploadMenuClicked() {
        _("add_student").style.display = "none";
        _("upload_video").style.display = "block";

        $.post("http://bhoomi.pe.hu/entei/getVideos.php", {}, function(res, err) {
          videos = JSON.parse(res).videos;
          _("data_panel").innerHTML = "";
          videos.forEach(function(video, i) {
            let cardId = "show_" + i;
            //onclick='removeVideo(" + video.videos_id + ")'
            _("data_panel").innerHTML +=
              "<div    class='col-lg-4' style='margin-top:20px;cursor:pointer; '><div class='card'><div class='card-header'>" +
              video.videos_title +
              "</div>" +
              "<div class='card-body'>" +
              video.name +
              "</div><div class='card-footer'> <div style='float:right;'>" +
              " <button class='btn btn-primary' onclick='onVideoClick(this)' id='" +
              cardId +
              "'> Show</button>&nbsp;<button class='btn btn-danger' id='delete'  onclick='removeVideo(" +
              video.videos_id +
              ")'  >DELETE</button> </div></div>  </div></div>";
          });
        });
      }

      function sendIvitationClicked() {
        _("add_student").style.display = "block";
        _("upload_video").style.display = "none";
        onLoad();
      }
    </script>
    <script>
      function removeVideo(id) {
        let sql = "delete from videos where videos_id=" + id;
        $.post("http://bhoomi.pe.hu/entei/query.php", { sql: sql, op: "DELETE" }, function(res, err) {
          console.log(res);
          uploadMenuClicked();
        });
      }

      var classSelect = $("#class");
      for (var i = 0; i < 10; i++) classSelect.append("<option value='" + (i + 1) + "'>" + (i + 1) + "</option>");

      function onSubmit() {
        let vname = _("video_name").value;
        let category = _("category").value;
        let clss = _("class").value;
        let desc = _("desc").value;

        let video = document.getElementById("video_file").files[0]; // file from input'
        let req = new XMLHttpRequest();
        let formData = new FormData();
        formData.append("file", video);
        formData.append("info", JSON.stringify({ vname: vname, category: category, class: clss, desc: desc }));

        req.open("POST", "upload.php");
        req.send(formData);
        document.getElementById("loading").style.display = "block";

        req.onreadystatechange = function() {
          if (req.readyState === 4 && req.status === 200) {
            document.getElementById("loading").style.display = "none";
            uploadMenuClicked();
            alert("uploaded");
          }
        };
      }
    </script>
    <!--VIDEOS-->
  </body>
</html>
